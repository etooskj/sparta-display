<!-- BUILD: 2026-01-13T06:34:39.598887 -->
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SPARTA SAM ì†¡ë„ì„¼í„° | ì‹¤ì‹œê°„ ì‹œê°„í‘œ</title>
  <style>
    :root{
      --bg:#0b0d12;
      --fg:#ffffff;
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.50);
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --accent:#d11f2e; /* ìŠ¤íŒŒë¥´íƒ€ ë ˆë“œ ëŠë‚Œ */
      --accent2:#2b6cff;
      --accent3:#1fbf75;
      --accent4:#a855f7;
      --shadow: 0 18px 60px rgba(0,0,0,.40);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Pretendard", "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 15% 15%, rgba(209,31,46,.16), transparent 60%),
                  radial-gradient(900px 600px at 80% 20%, rgba(43,108,255,.14), transparent 55%),
                  radial-gradient(1000px 700px at 60% 85%, rgba(31,191,117,.10), transparent 60%),
                  var(--bg);
      color:var(--fg);
      overflow:hidden;
    }

    .wrap{
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:18px;
      padding:28px 30px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width: 360px;
    }
    .logo{
      width:44px; height:44px;
      border-radius:14px;
      background: linear-gradient(135deg, rgba(209,31,46,1), rgba(209,31,46,.65));
      background-image: url("helmet.png");
      background-repeat:no-repeat;
      background-position:center;
      background-size: 70%;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute;
      inset:-18px -18px auto auto;
      width:70px; height:70px;
      background: rgba(255,255,255,.18);
      transform: rotate(25deg);
      border-radius: 24px;
    }
    .brand h1{
      font-size:20px;
      letter-spacing:.4px;
      margin:0;
      line-height:1.2;
    }
    .brand .sub{
      font-size:18px;
      color:var(--muted);
      margin-top:3px;
    }

    .topRight{
      display:flex;
      align-items:flex-start;
      justify-content:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }
    .pill .k{ color: var(--muted2); font-size:17px; }
    .pill .v{ font-weight:700; font-size:20px; letter-spacing:.3px; }

    button{
      appearance:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--fg);
      border-radius:14px;
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }
    button:hover{ background: rgba(255,255,255,.10); }
    button:active{ transform: translateY(1px); }

    main{
      display:grid;
      grid-template-columns: 1.6fr .9fr;
      gap:18px;
      min-height:0;
    }

    .hero{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:26px;
      padding:22px 22px 18px 22px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }

    .hero::before{
      content:"";
      position:absolute;
      inset:auto -160px -160px auto;
      width:420px; height:420px;
      background: radial-gradient(circle at 30% 30%, rgba(209,31,46,.35), transparent 55%);
      filter: blur(1px);
      transform: rotate(-15deg);
      pointer-events:none;
    }

    .heroTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }

    .statusBadge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:18px;
      font-weight:800;
      letter-spacing:.2px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
    }

    .dot{
      width:10px; height:10px;
      border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(209,31,46,.18);
    }

    .heroTitle{
      margin-top:12px;
      font-size:88px;
      line-height:1.05;
      letter-spacing:-.8px;
      margin-bottom:6px;
      font-weight:900;
      word-break:keep-all;
    }

    .heroSubtitle{
      color:var(--muted);
      font-size:26px;
      line-height:1.4;
      margin:0 0 18px 0;
      word-break:keep-all;
    }

    .metaRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }

    .card{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius:20px;
      padding:14px 14px;
      min-height:84px;
    }
    .card .k{
      color:var(--muted2);
      font-size:17px;
      margin-bottom:6px;
    }
    .card .v{
      font-size:26px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .card .s{
      margin-top:6px;
      color:var(--muted);
      font-size:18px;
    }

    .progressWrap{
      margin-top:14px;
      border-radius:999px;
      height:12px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .progressBar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(209,31,46,1), rgba(255,255,255,.20));
      border-radius:999px;
      transition: width .4s ease;
    }

    .side{
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:18px;
      min-height:0;
    }

    .tableCard{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius:26px;
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .tableHead{
      padding:16px 16px 12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .tableHead h2{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .small{
      font-size:17px;
      color:var(--muted);
    }

    .rows{
      padding:10px 10px 10px 10px;
      overflow:auto;
    }
    .row{
      display:grid;
      grid-template-columns: 96px 1fr 92px;
      gap:10px;
      padding:10px 10px;
      border-radius:18px;
      border:1px solid transparent;
      align-items:center;
    }
    .row + .row{ margin-top:8px; }
    .row .t{
      font-variant-numeric: tabular-nums;
      font-weight:900;
      letter-spacing:.2px;
    }
    .row .l{
      color:var(--muted);
      font-weight:800;
      word-break:keep-all;
    }
    .row .tag{
      justify-self:end;
      font-size:17px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }
    .row.active{
      border-color: rgba(229,57,53,.55);
      background: rgba(255,234,234,.95); /* brand red highlight */
      box-shadow: 0 10px 30px rgba(229,57,53,.12);
    }
    .row{ position:relative; }
    .row.active::before{
      content:"";
      position:absolute;
      left:10px;
      top:10px;
      bottom:10px;
      width:8px;
      border-radius:999px;
      background: rgba(229,57,53,1);
    }
    .row.active{ padding-left:26px; }
    .row.active .t{ color: rgba(20,20,20,.96); }
    .row.active .l{ color: rgba(30,30,30,.78) !important; }
    .row.active div[style*='font-weight:900']{ color: rgba(10,10,10,.98); }
    .row.active .tag{
      border-color: rgba(229,57,53,.35);
      background: rgba(229,57,53,.12);
      color: rgba(120,0,0,.92);
    }

    footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      color:var(--muted2);
      font-size:17px;
      border-top:1px solid rgba(255,255,255,.10);
      padding-top:14px;
    }

    .note{
      color:var(--muted);
      line-height:1.35;
      word-break:keep-all;
    }

    .kbd{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      border-radius:10px;
      padding:4px 8px;
      font-weight:900;
      color: rgba(255,255,255,.85);
    }

    /* ìƒíƒœë³„ ì»¬ëŸ¬ */
    body.mode-class .dot{ background: var(--accent); box-shadow:0 0 0 6px rgba(209,31,46,.18); }
    body.mode-break .dot{ background: var(--accent2); box-shadow:0 0 0 6px rgba(43,108,255,.18); }
    body.mode-meal  .dot{ background: var(--accent3); box-shadow:0 0 0 6px rgba(31,191,117,.18); }
    body.mode-open  .dot{ background: rgba(255,255,255,.80); box-shadow:0 0 0 6px rgba(255,255,255,.12); }
    body.mode-night .dot{ background: var(--accent4); box-shadow:0 0 0 6px rgba(168,85,247,.16); }
    body.mode-off   .dot{ background: rgba(255,255,255,.35); box-shadow:0 0 0 6px rgba(255,255,255,.08); }

    body.mode-break .progressBar{ background: linear-gradient(90deg, rgba(43,108,255,1), rgba(255,255,255,.18));}
    body.mode-meal  .progressBar{ background: linear-gradient(90deg, rgba(31,191,117,1), rgba(255,255,255,.18));}
    body.mode-open  .progressBar{ background: linear-gradient(90deg, rgba(255,255,255,.85), rgba(255,255,255,.18));}
    body.mode-night .progressBar{ background: linear-gradient(90deg, rgba(168,85,247,1), rgba(255,255,255,.18));}

    /* ìŠ¤í¬ë¡¤ë°” (TVì—ì„œ ê¹”ë”í•˜ê²Œ) */
    .rows::-webkit-scrollbar{ width:10px; }
    .rows::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.10); border-radius:999px; }
    .rows::-webkit-scrollbar-track{ background: rgba(255,255,255,.03); border-radius:999px; }
  
    /* ëª¨ë“œë³„ ì „ì²´ ë°°ê²½(ë©€ë¦¬ì„œë„ í•œëˆˆì—) */
    body.mode-class{
      background: radial-gradient(1400px 800px at 20% 15%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(135deg, rgba(209,31,46,.30), rgba(11,13,18,1) 55%);
    }
    body.mode-break{
      background: radial-gradient(1200px 700px at 15% 15%, rgba(255,255,255,.07), transparent 60%),
                  linear-gradient(135deg, rgba(43,108,255,.28), rgba(11,13,18,1) 58%);
    }
    body.mode-meal{
      background: radial-gradient(1200px 700px at 15% 15%, rgba(255,255,255,.07), transparent 60%),
                  linear-gradient(135deg, rgba(31,191,117,.24), rgba(11,13,18,1) 60%);
    }
    body.mode-open{
      background: radial-gradient(1200px 700px at 15% 15%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(135deg, rgba(255,255,255,.10), rgba(11,13,18,1) 62%);
    }
    body.mode-night{
      background: radial-gradient(1200px 700px at 15% 15%, rgba(255,255,255,.07), transparent 60%),
                  linear-gradient(135deg, rgba(168,85,247,.24), rgba(11,13,18,1) 60%);
    }
    body.mode-off{
      background: radial-gradient(1200px 700px at 15% 15%, rgba(255,255,255,.05), transparent 60%),
                  linear-gradient(135deg, rgba(255,255,255,.06), rgba(11,13,18,1) 65%);
    }

    /* í™”ë©´ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
    .hero, .tableCard, .pill, .statusBadge{
      transition: transform .35s ease, background .35s ease, border-color .35s ease, box-shadow .35s ease, filter .35s ease;
    }
    body.flash .hero{
      transform: translateY(-2px) scale(1.01);
      filter: brightness(1.08);
    }

    /* ìƒë‹¨ ë°°ë„ˆ(ì£¼ë§/ê³µíœ´ì¼ ëª¨ë“œ) */
    .banner{
      margin-top:10px;
      padding:10px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-weight:900;
      letter-spacing:.2px;
      display:none;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }
    .banner small{
      display:block;
      margin-top:4px;
      font-weight:800;
      color: rgba(255,255,255,.72);
      letter-spacing:0;
    }

  
    /* íˆ¬êµ¬ ì›Œí„°ë§ˆí¬ */
    .hero::after{
      content:"";
      position:absolute;
      inset:auto -40px -80px auto;
      width:min(520px, 42vw);
      height:min(520px, 42vw);
      background: url("helmet.png") no-repeat center / contain;
      opacity:.14;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.45));
      transform: rotate(-8deg);
      pointer-events:none;
    }
    .tableCard.logoBg{
      position:relative;
    }
    .tableCard.logoBg::after{
      content:"";
      position:absolute;
      inset:auto -60px -90px auto;
      width:360px;
      height:360px;
      background: url("helmet.png") no-repeat center / contain;
      opacity:.08;
      pointer-events:none;
      filter: drop-shadow(0 16px 34px rgba(0,0,0,.35));
      transform: rotate(-10deg);
    }

  
    /* í™”ë©´ ì „ì²´ í•˜ë‹¨ ìš´ì˜ì•ˆë‚´ ë°” */
    .bottomNotice{
      margin-top:20px;
      border-radius:26px;
      padding:0;
      background: linear-gradient(135deg,
        rgba(209,31,46,.18),
        rgba(0,0,0,.75)
      );
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
    }
    .noticeInner{
      padding:36px 40px;
    }
    .noticeTitle{
      font-size:30px;
      font-weight:900;
      letter-spacing:.6px;
      margin-bottom:18px;
    }
    .noticeBody{
      font-size:22px;
      line-height:1.8;
      color:rgba(255,255,255,.92);
    }


    .btn.danger{
      background: rgba(209,31,46,.18);
      border: 1px solid rgba(209,31,46,.45);
    }
    .btn.danger.on{
      background: rgba(209,31,46,.35);
      border-color: rgba(209,31,46,.7);
    }
    #toast{
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.75);
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 16px;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
    }
    #toast.show{ opacity: 1; }
    .noticeBody, .noticeTitle, footer, .pill, button, select{
      word-break: keep-all;
      overflow-wrap: normal;
    }


/* ===== í…Œë§ˆ ì‹œìŠ¤í…œ (ë‹¤í¬/ë¼ì´íŠ¸/ê³ ëŒ€ë¹„) ===== */
:root{
  --bg:#0f1115;
  --panel:#171a21;
  --panel2:#1c2029;
  --text:#ffffff;
  --muted:#b8bcc8;
  --border: rgba(255,255,255,.10);
  --accent:#e53935;
  --btnBg: rgba(255,255,255,.06);
  --btnBorder: rgba(255,255,255,.14);
}
:root.theme-light{
  --bg:#f5f6f8;
  --panel:#ffffff;
  --panel2:#ffffff;
  --text:#111111;
  --muted:#444444;
  --border: rgba(0,0,0,.12);
  --accent:#c62828;
  --btnBg: rgba(0,0,0,.04);
  --btnBorder: rgba(0,0,0,.14);
}
:root.theme-contrast{
  --bg:#ffffff;
  --panel:#ffffff;
  --panel2:#ffffff;
  --text:#000000;
  --muted:#000000;
  --border: #000000;
  --accent:#000000;
  --btnBg:#ffffff;
  --btnBorder:#000000;
}

/* ê´‘ë²”ìœ„í•˜ê²Œ ì ìš© (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ„ì— ë®ì–´ì“°ê¸°) */
body{ background:var(--bg) !important; color:var(--text) !important; }
header{ background:var(--panel) !important; color:var(--text) !important; border-color:var(--border) !important; }
.pill{ background:var(--panel2) !important; color:var(--text) !important; border-color:var(--border) !important; }
.panel{ background:var(--panel) !important; color:var(--text) !important; border-color:var(--border) !important; }
.btn{ background:var(--btnBg) !important; border-color:var(--btnBorder) !important; color:var(--text) !important; }
select, input[type="range"]{ accent-color: var(--accent); }


    .miniOpt{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:var(--btnBg);
      user-select:none;
      font-size:14px;
      line-height:1;
      height:40px;
    }
    .miniOpt input{ width:16px; height:16px; }


/* ===== v4.7.1 í…Œë§ˆ ê°€ë…ì„± íŒ¨ì¹˜ (ë¼ì´íŠ¸/ê³ ëŒ€ë¹„ ë²„íŠ¼ ê¸€ì”¨ ë¬¸ì œ í•´ê²°) =====
   v4 ì›ë³¸ì€ --fg / --muted / --muted2 ë“± ë³€ìˆ˜ë¡œ ê¸€ì”¨ìƒ‰ì„ ì •í•©ë‹ˆë‹¤.
   ë¼ì´íŠ¸/ê³ ëŒ€ë¹„ì—ì„œ ì´ ë³€ìˆ˜ë¥¼ ê°™ì´ ë°”ê¿”ì¤˜ì•¼ ë²„íŠ¼/í•„ë“œ ê¸€ì”¨ê°€ ì„ ëª…í•´ì§‘ë‹ˆë‹¤.
*/
:root{
  --fg: var(--text);
}
:root.theme-light{
  --fg: #111111;
  --muted: rgba(0,0,0,.72);
  --muted2: rgba(0,0,0,.62);
  --border: rgba(0,0,0,.14);
}
:root.theme-contrast{
  --fg: #000000;
  --muted: #000000;
  --muted2: #000000;
  --border: #000000;
}
/* ë²„íŠ¼/ì²´í¬ë°•ìŠ¤/ì…€ë ‰íŠ¸ í…ìŠ¤íŠ¸ë¥¼ ê°•ì œ ì„ ëª…í•˜ê²Œ */
button, .btn, select, option, label{ color: var(--fg) !important; }


/* ===== v4.7.2 ì¼ë°˜ëª¨ë“œì—ì„œëŠ” ì„¤ì • UI ìˆ¨ê¹€ (ê´€ë¦¬ìëª¨ë“œì—ì„œë§Œ í‘œì‹œ) ===== */
html:not(.admin-on) .adminOnly{ display:none !important; }
/* ê´€ë¦¬ì ë²„íŠ¼ì€ ì¼ë°˜ëª¨ë“œì—ì„œë„ ë³´ì´ê²Œ(ì‘ê²Œ) */
html:not(.admin-on) #adminLockBtn{ opacity:.78; }


/* ===== v4.7.4 ì „ê´‘íŒ ìš´ìš© ì˜µì…˜: ìë™ ì „ì²´í™”ë©´ ìœ ë„ + ìƒˆë¡œê³ ì¹¨ ë°©ì§€ ===== */
#fsPrompt{
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.35);
  z-index: 9998;
}
#fsPrompt .box{
  background: rgba(255,255,255,.92);
  color: #111;
  border-radius: 18px;
  padding: 18px 20px;
  min-width: 280px;
  max-width: min(520px, 92vw);
  text-align: center;
  box-shadow: 0 16px 40px rgba(0,0,0,.25);
  border: 1px solid rgba(0,0,0,.08);
}
html.theme-light #fsPrompt .box,
html.theme-contrast #fsPrompt .box{ background: rgba(255,255,255,.94); color:#111; }
#fsPrompt .title{ font-size: 18px; font-weight: 800; margin-bottom: 10px; }
#fsPrompt .desc{ font-size: 14px; opacity:.9; margin-bottom: 14px; line-height: 1.35; }
#fsPrompt .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
#fsPrompt .actions button{
  height: 42px; padding: 0 14px; border-radius: 14px;
  border: 1px solid rgba(0,0,0,.15);
  background: #111; color:#fff; font-weight: 700;
}
#fsPrompt .actions button.secondary{
  background: rgba(0,0,0,.06); color:#111;
}


/* ===== v4.7.6 í˜„ì¬ì‹œê° í‘œì‹œ/3ë‹¨ê³„ ì•ˆë‚´ ===== */
#nowClock{ font-weight: 900; letter-spacing: .5px; font-variant-numeric: tabular-nums; }


/* ===== v4.7.7: ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬(ë²„íŠ¼ êµ¬ë¶„) + í˜„ì¬ì‹œê° í•­ìƒ í‘œì‹œ ===== */
#adminPwModal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; }
#adminPwModal.show{ display:flex; }
#adminPwModal .adminPwBackdrop{ position:absolute; inset:0; background:rgba(0,0,0,.45); backdrop-filter: blur(6px); }
#adminPwModal .adminPwCard{
  position:relative;
  width:min(520px, 92vw);
  border-radius: 18px;
  padding: 18px 18px 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,.35);
  border: 1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.96);
  color:#111;
}
html.theme-dark #adminPwModal .adminPwCard{ background: rgba(24,24,28,.94); color:#fff; border-color: rgba(255,255,255,.12); }
#adminPwModal .adminPwTitle{ font-size:18px; font-weight:900; }
#adminPwModal .adminPwDesc{ margin-top:6px; font-size:13px; opacity:.85; }
#adminPwInput{
  margin-top:12px;
  width:100%;
  height:46px;
  padding:0 14px;
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,.18);
  background: rgba(255,255,255,.9);
  color:#111;
  font-size:16px;
}
html.theme-dark #adminPwInput{ background: rgba(0,0,0,.25); border-color: rgba(255,255,255,.18); color:#fff; }
.adminPwActions{ display:flex; gap:10px; justify-content:flex-end; margin-top:14px; }
#adminPwModal .btnPrimary{
  height:44px; padding:0 16px; border-radius:14px;
  border:1px solid rgba(0,0,0,.08);
  background: #c01818; color:#fff; font-weight:900;
}
#adminPwModal .btnSecondary{
  height:44px; padding:0 16px; border-radius:14px;
  border:1px solid rgba(0,0,0,.18);
  background: rgba(0,0,0,.05); color:#111; font-weight:800;
}
html.theme-dark #adminPwModal .btnSecondary{
  background: rgba(255,255,255,.10); color:#fff; border-color: rgba(255,255,255,.18);
}

</style>
</head>

<body class="mode-off">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>SPARTA SAM SONGDO CENTER</h1>
          <div class="sub">ì¬í•™ìƒ / Nìˆ˜ìƒ ëŒ€ìƒ Â· ì‹¤ì‹œê°„ ì‹œê°„í‘œ</div>

        <div class="banner" id="banner">
          ì˜¤ëŠ˜ì€ <span id="dayModeText">ììœ¨ ë“±ì›</span> ëª¨ë“œì…ë‹ˆë‹¤
          <small id="dayModeSub">ê³µíœ´ì¼/ì¼ìš”ì¼: ì‹ì‚¬ ë°°ë‹¬ ì„œë¹„ìŠ¤ ë¯¸ì œê³µ</small>
        </div>
        </div>
      </div>

      <div class="topRight">
        
        <button id="adminLockBtn" class="btn danger">ğŸ”’ ê´€ë¦¬ì ì ê¸ˆ(ON)</button>
        <button id="btnFull">ì „ì²´í™”ë©´</button>

        <div class="pill" title="PC ì‹œê°„ì´ ìë™ë™ê¸°í™” ìƒíƒœë©´ ì´ ì‹œê°„ì´ ê¸°ì¤€ì…ë‹ˆë‹¤.">
          <div class="k">í˜„ì¬ì‹œê°</div>
          <div class="v" id="nowClock">--:--:--</div>
        </div>

        
<!-- admin-only controls begin -->
        <div class="adminOnly">
<div class="pill">
          <div class="k">ì†Œë¦¬</div>
          <div class="v" id="soundState">OFF</div>
        </div>

        <div class="pill">
          <div class="k">ì•ˆë‚´</div>
          <div class="v" id="voiceState">OFF</div>
        </div>

        <div class="pill">
          <div class="k">1ë¶„ì „ ì˜ˆê³ </div>
          <div class="v" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <label><input type="checkbox" id="warnBreakEnd" checked> íœ´ì‹ ì¢…ë£Œ</label>
            <label><input type="checkbox" id="warnMealEnd" checked> ì‹ì‚¬ ì¢…ë£Œ</label>
            <label><input type="checkbox" id="warnClassEnd" checked> ìˆ˜ì—… ì¢…ë£Œ</label>
          </div>
        </div>

        <div class="pill adminOnly">
          <div class="k">3ë‹¨ê³„ ì•ˆë‚´</div>
          <div class="v" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <label><input type="checkbox" id="stage5" checked> 5ë¶„ ì „</label>
            <label><input type="checkbox" id="stage1" checked> 1ë¶„ ì „</label>
            <label><input type="checkbox" id="stage0" checked> ì¢…ë£Œ ì‹œ</label>
          </div>
        </div>




        <div class="pill">
          <div class="k">ìŒì„± ë³¼ë¥¨</div>
          <div class="v">
            <input id="voiceVol" type="range" min="0" max="1000" value="300" style="width:160px;" />
            <span id="voiceVolText" style="display:inline-block; width:46px; text-align:right;">85%</span>
          </div>
        </div>



        <div class="pill">
          <div class="k">ì¢…ì†Œë¦¬</div>
          <div class="v">
            <select id="bellSelect" style="font-size:16px; font-weight:900; border-radius:10px; padding:6px 8px; border:1px solid rgba(255,255,255,.18); background: rgba(0,0,0,.25); color: rgba(255,255,255,.92);">
              <option value="web_classic" selected>ê¸°ë³¸(í´ë˜ì‹)</option>
              <option value="web_school">í•™êµì¢…(ë˜ë ·)</option>
              <option value="web_soft">ë¶€ë“œëŸ½ê²Œ</option>
              <option value="web_strong">ê°•í•˜ê²Œ</option>
              <option value="mp3_bell">MP3 bell.mp3</option>
              <option value="mp3_bell1">MP3 bell1.mp3</option>
              <option value="mp3_bell2">MP3 bell2.mp3</option>
            </select>
          </div>
        </div>

        <div class="pill">
          <div class="k">ë³¼ë¥¨</div>
          <div class="v">
            <input id="vol" type="range" min="0" max="1000" value="300" style="width:160px;" />
            <span id="volText" style="display:inline-block; width:46px; text-align:right;">85%</span>
          </div>
        </div>


        <button id="btnSound">ì†Œë¦¬ ì¼œê¸°</button>
        <button id="btnTest">ì¢…ì†Œë¦¬ í…ŒìŠ¤íŠ¸</button>
        <button id="btnVoice">ì•ˆë‚´ ìŒì„± ì¼œê¸°</button>
        
        <button id="voiceTestBtn" class="btn">ì•ˆë‚´ ìŒì„± í…ŒìŠ¤íŠ¸</button>
        <button id="btnDayMode">ì£¼ë§/ê³µíœ´ì¼ ìë™</button>
        

        <button id="themeBtn" class="btn">ğŸŒ— í…Œë§ˆ: ë‹¤í¬</button>
        <label class="miniOpt"><input type="checkbox" id="themeAuto"> ìë™</label>
        <label class="miniOpt"><input type="checkbox" id="themeLock"> í…Œë§ˆ ì ê¸ˆ</label>

      </div>
    </header>

    <main>
      <section class="hero">
        <div class="heroTop">
          <div class="statusBadge"><span class="dot" aria-hidden="true"></span><span id="statusText">ìš´ì˜ ì‹œê°„ í™•ì¸ ì¤‘â€¦</span></div>
          <div class="pill">
            <div class="k">ë‚¨ì€ ì‹œê°„</div>
            <div class="v" id="remain">--:--</div>
          </div>
        </div>

        <div class="heroTitle" id="title">â€”</div>
        <p class="heroSubtitle" id="subtitle">ì‹œê°„ì´ ë°”ë€Œë©´ í™”ë©´ì´ ìë™ìœ¼ë¡œ ì „í™˜ë˜ê³ , ì¢…ì†Œë¦¬ê°€ ìš¸ë¦½ë‹ˆë‹¤. (ì†Œë¦¬ ì‚¬ìš© ì‹œ ìƒë‹¨ì—ì„œ â€œì†Œë¦¬ ì¼œê¸°â€ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.)</p>

        <div class="metaRow">
          <div class="card">
            <div class="k">í˜„ì¬ êµ¬ê°„</div>
            <div class="v" id="curRange">--:-- ~ --:--</div>
            <div class="s" id="curInfo">â€”</div>
          </div>
          <div class="card">
            <div class="k">ë‹¤ìŒ êµ¬ê°„</div>
            <div class="v" id="nextTitle">â€”</div>
            <div class="s" id="nextRange">--:--</div>
          </div>
        </div>

        <div class="progressWrap" aria-label="ì§„í–‰ë¥ ">
          <div class="progressBar" id="progress"></div>
        </div>
      </section>

      <aside class="side">
        <div class="tableCard logoBg">
          <div class="tableHead">
            <h2>ì˜¤ëŠ˜ ì‹œê°„í‘œ</h2>
            <div class="small">í˜„ì¬ êµ¬ê°„ì´ ìë™ ê°•ì¡°ë©ë‹ˆë‹¤</div>
          </div>
          <div class="rows" id="rows"></div>
        </div>

        <!-- OPERATING NOTICE MOVED TO BOTTOM -->
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <div style="font-weight:900;">ìš´ì˜ ì•ˆë‚´</div>
            <div class="small">ë©”ëª¨ëŠ” í•„ìš”í•˜ë©´ ìˆ˜ì • ê°€ëŠ¥</div>
          </div>
          <div class="note" style="margin-top:14px; line-height:1.6;">
            â€¢ í‰ì¼ ë° í† ìš”ì¼: <b>2~8êµì‹œ ì˜ë¬´ í•™ìŠµ</b> / ê³µíœ´ì¼ ë° ì¼ìš”ì¼: <b>ììœ¨ ë“±ì› í•™ìŠµ</b><br/>
            â€¢ ê³µíœ´ì¼ ë° ì¼ìš”ì¼: <b>ì‹ì‚¬ ë°°ë‹¬ ì„œë¹„ìŠ¤ ë¯¸ì œê³µ</b><br/>
            â€¢ í™”ë©´/ì¢…ì†Œë¦¬ íƒ€ì´ë°ì€ ì´ PC(ë˜ëŠ” TV)ì˜ <b>ì‹œê³„ ì‹œê°„</b>ì„ ê¸°ì¤€ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
          </div>
        </div>
      </aside>
    </main>


    <section class="bottomNotice">
      <div class="noticeInner">
        <div class="noticeTitle">ìš´ì˜ ì•ˆë‚´</div>
        <div class="noticeBody">
          â€¢ í‰ì¼ ë° í† ìš”ì¼: <b>2~8êµì‹œ ì˜ë¬´ í•™ìŠµ</b> / ê³µíœ´ì¼ ë° ì¼ìš”ì¼: <b>ììœ¨ ë“±ì› í•™ìŠµ</b><br/>
          â€¢ ê³µíœ´ì¼ ë° ì¼ìš”ì¼: <b>ì‹ì‚¬ ë°°ë‹¬ ì„œë¹„ìŠ¤ ë¯¸ì œê³µ</b><br/>
          â€¢ í™”ë©´/ì¢…ì†Œë¦¬ íƒ€ì´ë°ì€ ì´ PC(ë˜ëŠ” TV)ì˜ <b>ì‹œê³„ ì‹œê°„</b>ì„ ê¸°ì¤€ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
        </div>
      </div>
    </section>


    <footer>
      <div>ì¡°ì‘: <span class="kbd">F11</span> (í¬ë¡¬ ì „ì²´í™”ë©´) Â· <span class="kbd">Ctrl</span>+<span class="kbd">R</span> (ìƒˆë¡œê³ ì¹¨)</div>
      <div>SPARTA SAM Â· Songdo Center</div>
    </footer>
  </div>

<script>
// ===== Global KST helper (ABSOLUTE TOP) =====
function getKSTDate(){
  const now = new Date();
  const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
  return new Date(utc + (9 * 60 * 60000));
}

/**
 * SPARTA SAM ì†¡ë„ì„¼í„° ì‹¤ì‹œê°„ ì‹œê°„í‘œ (ë‹¨ì¼ HTML)
 * - ì‹¤ì‹œê°„ ì‹œê³„ ê¸°ë°˜ìœ¼ë¡œ í˜„ì¬ êµ¬ê°„ì„ ê³„ì‚°
 * - êµ¬ê°„ì´ ë°”ë€Œë©´ ì¢…ì†Œë¦¬(ì›¹ì˜¤ë””ì˜¤) ì¬ìƒ (ì‚¬ìš©ì í´ë¦­ìœ¼ë¡œ í™œì„±í™” í•„ìš”)
 * - ì „ì²´í™”ë©´ ë²„íŠ¼ ì œê³µ
 */

const schedule = [
  { key:"open0", start:"06:00", end:"08:00", type:"open",  label:"OPEN (0êµì‹œ)", info:"ììœ¨ ì…ì‹¤/ì¤€ë¹„" },
  { key:"p1",    start:"08:00", end:"08:50", type:"class", label:"1êµì‹œ", info:"ìˆ˜ì—…/ììŠµ" },
  { key:"b1",    start:"08:50", end:"09:00", type:"break", label:"íœ´ì‹", info:"ì´ë™ ì‹œê°„" },
  { key:"p2",    start:"09:00", end:"10:15", type:"class", label:"2êµì‹œ", info:"*ì˜ë¬´ í•™ìŠµ ì‹œì‘" },
  { key:"b2",    start:"10:15", end:"10:30", type:"break", label:"íœ´ì‹", info:"íœ´ì‹/ì´ë™" },
  { key:"p3",    start:"10:30", end:"12:00", type:"class", label:"3êµì‹œ", info:"ìˆ˜ì—…/ììŠµ" },
  { key:"lunch", start:"12:00", end:"13:10", type:"meal",  label:"LUNCH", info:"ì‹ì‚¬ ë°°ë‹¬ / ì™¸ì¶œ / ê°œì¸ ë„ì‹œë½" },
  { key:"p4",    start:"13:10", end:"14:30", type:"class", label:"4êµì‹œ", info:"ìˆ˜ì—…/ììŠµ" },
  { key:"b3",    start:"14:30", end:"14:45", type:"break", label:"íœ´ì‹", info:"ì´ë™ ì‹œê°„" },
  { key:"p5",    start:"14:45", end:"16:15", type:"class", label:"5êµì‹œ", info:"ìˆ˜ì—…/ììŠµ" },
  { key:"b4",    start:"16:15", end:"16:30", type:"break", label:"íœ´ì‹", info:"ì´ë™ ì‹œê°„" },
  { key:"p6",    start:"16:30", end:"18:00", type:"class", label:"6êµì‹œ", info:"ìˆ˜ì—…/ììŠµ" },
  { key:"dinner",start:"18:00", end:"19:10", type:"meal",  label:"DINNER", info:"ì‹ì‚¬ ë°°ë‹¬ / ì™¸ì¶œ / ê°œì¸ ë„ì‹œë½" },
  { key:"p7",    start:"19:10", end:"20:40", type:"class", label:"7êµì‹œ", info:"ìˆ˜ì—…/ììŠµ" },
  { key:"b5",    start:"20:40", end:"20:55", type:"break", label:"íœ´ì‹", info:"ì´ë™ ì‹œê°„" },
  { key:"p8",    start:"20:55", end:"21:50", type:"class", label:"8êµì‹œ", info:"**í‰ì¼ ì˜ë¬´ í•™ìŠµ ì¢…ë£Œ" },
  { key:"b6",    start:"21:50", end:"22:05", type:"break", label:"íœ´ì‹", info:"ì´ë™ ì‹œê°„" },
  { key:"night", start:"22:05", end:"23:00", type:"night", label:"ì•¼ê°„ í•™ìŠµ", info:"ììœ¨ í•™ìŠµ" }
];

// ---------- helpers ----------
const $ = (id)=>document.getElementById(id);

function toMin(hhmm){
  const [h,m] = hhmm.split(":").map(Number);
  return h*60 + m;
}

function fmt2(n){ return String(n).padStart(2,"0"); }

function fmtClock(d){
  return `${fmt2(d.getHours())}:${fmt2(d.getMinutes())}:${fmt2(d.getSeconds())}`;
}

function fmtRemain(totalSec){
  totalSec = Math.max(0, Math.floor(totalSec));
  const m = Math.floor(totalSec/60);
  const s = totalSec%60;
  return `${fmt2(m)}:${fmt2(s)}`;
}

function setMode(type){
  const map = {
    class:"mode-class",
    break:"mode-break",
    meal:"mode-meal",
    open:"mode-open",
    night:"mode-night",
    off:"mode-off"
  };
  document.body.className = map[type] || "mode-off";
}

// ---------- render table ----------
function renderRows(){
  const el = $("rows");
  el.innerHTML = "";
  schedule.forEach(item=>{
    const row = document.createElement("div");
    row.className = "row";
    row.dataset.key = item.key;
    row.innerHTML = `
      <div class="t">${item.start}</div>
      <div>
        <div style="font-weight:900;">${item.label}</div>
        <div class="l" style="font-size:17px; margin-top:2px;">${item.info || ""}</div>
      </div>
      <div class="tag">${tagText(item.type)}</div>
    `;
    el.appendChild(row);
  });
}

function tagText(type){
  switch(type){
    case "class": return "ìˆ˜ì—…/ì˜ë¬´";
    case "break": return "íœ´ì‹";
    case "meal":  return "ì‹ì‚¬";
    case "open":  return "ì˜¤í”ˆ";
    case "night": return "ì•¼ê°„";
    default:      return "â€”";
  }
}


// ---------- day mode (ì£¼ë§/ê³µíœ´ì¼ ìë™) ----------
/**
 * dayMode:
 * - "auto": í† ìš”ì¼/ì¼ìš”ì¼/ê³µíœ´ì¼ì´ë©´ ììœ¨ ë“±ì›/ë°°ë‹¬ ë¯¸ì œê³µ ë°°ë„ˆ í‘œì‹œ
 * - "weekday": í‰ì¼ ê³ ì •
 * - "holiday": ê³µíœ´ì¼/ì¼ìš”ì¼ ê³ ì • (ììœ¨ ëª¨ë“œ)
 */
let dayMode = "auto";
const HOLIDAYS = [
  // í•„ìš”í•˜ë©´ ë‚ ì§œë¥¼ ì¶”ê°€í•˜ì„¸ìš”. í˜•ì‹: "YYYY-MM-DD"
  // ì˜ˆ) "2026-01-01",
];

function isHolidayOrWeekend(d){
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  const key = `${yyyy}-${mm}-${dd}`;
  const dow = d.getDay(); // 0 Sun .. 6 Sat
  const weekend = (dow === 0 || dow === 6);
  const holiday = HOLIDAYS.includes(key);
  return { weekend, holiday, key, isOff: weekend || holiday };
}

function updateBanner(d){
  const b = $("banner");
  const modeText = $("dayModeText");
  const sub = $("dayModeSub");

  const st = isHolidayOrWeekend(d);
  let off = false;

  if(dayMode === "auto") off = st.isOff;
  if(dayMode === "holiday") off = true;
  if(dayMode === "weekday") off = false;

  if(off){
    b.style.display = "block";
    modeText.textContent = (st.holiday ? "ê³µíœ´ì¼" : (d.getDay()===0 ? "ì¼ìš”ì¼" : "ì£¼ë§")) + " ììœ¨ ë“±ì›";
    sub.textContent = "ê³µíœ´ì¼/ì¼ìš”ì¼: ì‹ì‚¬ ë°°ë‹¬ ì„œë¹„ìŠ¤ ë¯¸ì œê³µ";
  }else{
    b.style.display = "none";
  }
  return off;
}

// ---------- voice ì•ˆë‚´ (Web Speech API) ----------
let voiceEnabled = false;
let voiceVolume = 3.0; // 0~10 (UI 0~1000%)
const bellLengthMult = 10.0; // ì¢…ì†Œë¦¬ ê¸¸ì´ ì•½ 10ì´ˆ

function speak(text){
  if(!voiceEnabled) return;
  if(!("speechSynthesis" in window)) return;
  try{
    // ë„ˆë¬´ ê²¹ì¹˜ë©´ ëŠê³  ìƒˆë¡œ
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ko-KR";
    u.rate = 1.0;
    u.pitch = 1.0;
    u.volume = 1.0; u._spartaGain = voiceVolume;
    window.speechSynthesis.speak(u);
  }catch(e){
    // ë¬´ì‹œ
  }
}

// ---------- optional MP3 bell ----------
/**
 * ê°™ì€ í´ë”ì— bell.mp3 ë¥¼ ë„£ì–´ë‘ë©´ ìë™ìœ¼ë¡œ ê·¸ íŒŒì¼ì„ ìš°ì„  ì¬ìƒí•©ë‹ˆë‹¤.
 * ì—†ìœ¼ë©´ ê¸°ì¡´ WebAudio ë²¨(ë” í° ë³¼ë¥¨)ë¡œ ì¬ìƒí•©ë‹ˆë‹¤.
 */
let bellMp3 = null;
let bellMp3Ready = false;

async function probeBellMp3(filename="bell.mp3"){
  // ì§€ì • íŒŒì¼ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸(ì—†ìœ¼ë©´ WebAudioë¡œ ìë™ fallback)
  try{
    const res = await fetch(filename, { method: "HEAD", cache: "no-store" });
    bellMp3Ready = res.ok;
  }catch(e){
    bellMp3Ready = false;
  }
  if(bellMp3Ready){
    if(!bellMp3 || bellMp3.src.indexOf(filename) === -1){
      bellMp3 = new Audio(filename);
      bellMp3.preload = "auto";
    }
    bellMp3.volume = Math.max(0, Math.min(1, bellVolume)); // 0~1
  }else{
    bellMp3 = null;
  }
}

function resetBellMp3(){
  bellMp3Ready = false;
  bellMp3 = null;
}


// ---------- audio (WebAudio, user gesture needed) ----------
let audioCtx = null;
let soundEnabled = false;
let bellProfile = 'web_classic';
let bellVolume = 3.0; // 0~10 (UI 0~1000%)


function ensureAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // TV/ìŠ¤í”¼ì»¤ì—ì„œ ë” ë˜ë ·í•˜ê²Œ ë“¤ë¦¬ë„ë¡ ì»´í”„ë ˆì„œ(ë¦¬ë¯¸í„°) ì¶”ê°€
    const comp = audioCtx.createDynamicsCompressor();
    comp.threshold.setValueAtTime(-20, audioCtx.currentTime);
    comp.knee.setValueAtTime(18, audioCtx.currentTime);
    comp.ratio.setValueAtTime(8, audioCtx.currentTime);
    comp.attack.setValueAtTime(0.003, audioCtx.currentTime);
    comp.release.setValueAtTime(0.12, audioCtx.currentTime);
    audioCtx._spartaCompressor = comp;
  }
}

function beep(freq=880, dur=0.16, gain=0.85, when=0, wave="sine"){
  if(!soundEnabled || !audioCtx) return;

  const master = 4.0; // ê¸°ë³¸ ë§ˆìŠ¤í„°(ë¦¬ë¯¸í„° ì ìš©)
  gain = Math.max(0.02, Math.min(12.0, gain * bellVolume * master));

  // ì¢…ì†Œë¦¬ ê¸¸ì´ ì¡°ì •(ê¸°ë³¸ ëŒ€ë¹„ 5ë°°)
  dur = Math.max(0.05, dur * bellLengthMult);

  const t0 = audioCtx.currentTime + when;

  const osc = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  osc.type = wave;
  osc.frequency.value = freq;

  // attack/release(ì¢… ëŠë‚Œ)
  g.gain.setValueAtTime(0.0001, t0);
  g.gain.exponentialRampToValueAtTime(gain, t0 + 0.008);
  g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

  // í•˜ëª¨ë‹‰(ëª…ë£Œë„)
  const osc2 = audioCtx.createOscillator();
  const g2 = audioCtx.createGain();
  osc2.type = (wave === "sine") ? "triangle" : "sine";
  osc2.frequency.value = freq*2;
  g2.gain.setValueAtTime(0.0001, t0);
  g2.gain.exponentialRampToValueAtTime(gain*0.22, t0 + 0.008);
  g2.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);

  osc.connect(g);
  osc2.connect(g2);

  const comp = audioCtx._spartaCompressor;
  g.connect(comp);
  g2.connect(comp);
  comp.connect(audioCtx.destination);

  osc.start(t0);   osc.stop(t0 + dur + 0.03);
  osc2.start(t0);  osc2.stop(t0 + dur + 0.03);
}

function clickNoise(when=0, gain=0.6){
  if(!soundEnabled || !audioCtx) return;
  const t0 = audioCtx.currentTime + when;

  const bufferSize = audioCtx.sampleRate * 0.02; // 20ms
  const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = buffer.getChannelData(0);
  for(let i=0;i<bufferSize;i++){
    // ì§§ê²Œ ê°ì‡ í•˜ëŠ” ë…¸ì´ì¦ˆ
    data[i] = (Math.random()*2-1) * Math.exp(-i/(bufferSize/5));
  }
  const src = audioCtx.createBufferSource();
  src.buffer = buffer;

  const g = audioCtx.createGain();
  const master = 4.0;
  g.gain.setValueAtTime(Math.min(12.0, gain * bellVolume * master), t0);
  src.connect(g);

  const comp = audioCtx._spartaCompressor;
  g.connect(comp);
  comp.connect(audioCtx.destination);

  src.start(t0);
  src.stop(t0 + 0.03);
}



function playBell(type){
  // ì„ íƒëœ í”„ë¡œí•„ì— ë”°ë¼ MP3/WebAudio ì¤‘ ì¬ìƒ
  if(soundEnabled && bellProfile.startsWith("mp3_")){
    const fname = (bellProfile === "mp3_bell1") ? "bell1.mp3"
                : (bellProfile === "mp3_bell2") ? "bell2.mp3"
                : "bell.mp3";

    // íŒŒì¼ ì¡´ì¬ í™•ì¸ í›„ ì¬ìƒ(ì—†ìœ¼ë©´ WebAudioë¡œ fallback)
    probeBellMp3(fname);
    if(bellMp3Ready && bellMp3){
      bellMp3.volume = Math.max(0, Math.min(1, bellVolume));
      bellMp3.currentTime = 0;
      bellMp3.play().catch(()=> resetBellMp3());
      return;
    }
  }

  // ìœ í˜•ë³„ íŒ¨í„´(í”„ë¡œí•„ë³„ë¡œ 'ì™„ì „íˆ ë‹¤ë¥¸' ëŠë‚Œ)
  const p = bellProfile;

  // í”„ë¡œí•„ ì •ì˜
  const classic = (p === "web_classic"); // ë”©-ë™
  const school  = (p === "web_school");  // í•™êµì¢…(4íƒ€)
  const soft    = (p === "web_soft");    // ë¶€ë“œëŸ¬ìš´ 1~2íƒ€(ë‚®ì€ ìŒ, ê¸¸ê²Œ)
  const strong  = (p === "web_strong");  // ê°•í•˜ê²Œ(ë…¸ì´ì¦ˆ í´ë¦­ + ë¹ ë¥¸ 3íƒ€)

  // íŒŒí˜•(ì¬ì§ˆ)ë„ ë‹¤ë¥´ê²Œ
  const wave = classic ? "sine" : school ? "triangle" : soft ? "sine" : "square";

  switch(type){
    case "class": // ìˆ˜ì—… ì‹œì‘
      if(classic){
        // ë”©-ë™(ë‘ ìŒ)
        beep(988, 0.22, 0.95, 0.00, wave);
        beep(784, 0.28, 0.95, 0.30, wave);
      }else if(school){
        // í•™êµì¢… 4íƒ€ (ëª…í™•í•œ ë¦¬ë“¬)
        beep(988, 0.18, 0.95, 0.00, wave);
        beep(988, 0.18, 0.95, 0.24, wave);
        beep(1175,0.20, 0.90, 0.52, wave);
        beep(1319,0.22, 0.88, 0.80, wave);
      }else if(soft){
        // ë‚®ì€ ìŒ 1íƒ€(ê¸¸ê²Œ)
        beep(659, 0.42, 0.70, 0.00, wave);
        beep(784, 0.28, 0.55, 0.46, "triangle");
      }else if(strong){
        // í´ë¦­ + 3íƒ€(ê°•)
        clickNoise(0.00, 0.55);
        beep(1047,0.16, 1.00, 0.02, wave);
        clickNoise(0.22, 0.50);
        beep(1319,0.16, 1.00, 0.24, wave);
        clickNoise(0.44, 0.45);
        beep(1568,0.18, 0.95, 0.46, wave);
      }
      break;

    case "break": // ì‰¬ëŠ” ì‹œê°„
      if(classic){
        beep(784, 0.14, 0.85, 0.00, wave);
        beep(784, 0.14, 0.85, 0.18, wave);
      }else if(school){
        beep(659, 0.12, 0.90, 0.00, wave);
        beep(659, 0.12, 0.90, 0.16, wave);
        beep(523, 0.14, 0.85, 0.36, wave);
      }else if(soft){
        beep(523, 0.30, 0.60, 0.00, "sine");
      }else if(strong){
        clickNoise(0.00, 0.45);
        beep(880, 0.12, 0.95, 0.02, wave);
        clickNoise(0.18, 0.40);
        beep(880, 0.12, 0.95, 0.20, wave);
      }
      break;

    case "meal":  // ì‹ì‚¬
      if(classic){
        beep(659, 0.18, 0.85, 0.00, wave);
        beep(523, 0.18, 0.80, 0.22, wave);
        beep(659, 0.18, 0.85, 0.44, wave);
      }else if(school){
        beep(523, 0.18, 0.85, 0.00, wave);
        beep(659, 0.18, 0.88, 0.22, wave);
        beep(784, 0.20, 0.90, 0.48, wave);
      }else if(soft){
        beep(440, 0.46, 0.62, 0.00, "sine");
        beep(523, 0.28, 0.50, 0.50, "triangle");
      }else if(strong){
        clickNoise(0.00, 0.50);
        beep(740, 0.14, 1.00, 0.02, wave);
        clickNoise(0.22, 0.45);
        beep(988, 0.14, 1.00, 0.24, wave);
        clickNoise(0.44, 0.40);
        beep(1319,0.18, 0.95, 0.46, wave);
      }
      break;

    case "open":
      if(soft){
        beep(440, 0.40, 0.55, 0.00, "sine");
      }else{
        beep(523, 0.22, 0.80, 0.00, wave);
      }
      break;

    case "night":
      if(soft){
        beep(392, 0.42, 0.55, 0.00, "sine");
      }else{
        beep(880, 0.16, 0.75, 0.00, wave);
        beep(740, 0.18, 0.70, 0.22, wave);
      }
      break;

    default:
      beep(880, 0.18, 0.75, 0.00, wave);
  }
}

// ---------- core ticker ----------
let lastKey = null;

function findCurrent(minNow){
  for(let i=0;i<schedule.length;i++){
    const it = schedule[i];
    const s = toMin(it.start);
    const e = toMin(it.end);
    if(minNow >= s && minNow < e) return {item: it, index: i};
  }
  return null;
}

function _tickCore(){
  const now = getKSTDate();
  const offDay = updateBanner(now);
  $("nowClock").textContent = fmtClock(now);

  const minNow = now.getHours()*60 + now.getMinutes() + now.getSeconds()/60;
  const found = findCurrent(minNow);

  if(!found){
    // ìš´ì˜ ì™¸
    setMode("off");
    $("statusText").textContent = "ìš´ì˜ ì‹œê°„ ì™¸";
    $("title").textContent = "ìš´ì˜ ì‹œê°„ ì™¸";
    $("subtitle").textContent = "í˜„ì¬ëŠ” ì‹œê°„í‘œ ë²”ìœ„(06:00~23:00) ë°–ì…ë‹ˆë‹¤.";
    $("curRange").textContent = "--:-- ~ --:--";
    $("curInfo").textContent = "â€”";
    $("nextTitle").textContent = schedule[0]?.label || "â€”";
    $("nextRange").textContent = schedule[0] ? `${schedule[0].start} ~ ${schedule[0].end}` : "--:--";
    $("remain").textContent = "--:--";
    $("progress").style.width = "0%";
    highlightRow(null);
    lastKey = null;
    return;
  }

  const it = found.item;
  setMode(it.type);

  // ìƒíƒœ í…ìŠ¤íŠ¸
  const status = (it.type === "class") ? "ìˆ˜ì—…/ì˜ë¬´ í•™ìŠµ ì§„í–‰ ì¤‘"
                : (it.type === "break") ? "ì‰¬ëŠ” ì‹œê°„"
                : (it.type === "meal")  ? "ì‹ì‚¬ ì‹œê°„"
                : (it.type === "open")  ? "ì˜¤í”ˆ ì‹œê°„"
                : (it.type === "night") ? "ì•¼ê°„ í•™ìŠµ"
                : "ì§„í–‰ ì¤‘";
  $("statusText").textContent = status;

  $("title").textContent = it.label;
  // ê³µíœ´ì¼/ì¼ìš”ì¼ì—ëŠ” ë°°ë‹¬ ë¯¸ì œê³µ ì•ˆë‚´ë¥¼ ì‹ì‚¬ êµ¬ê°„ì— ë” ê°•ì¡°
  if(offDay && it.type==="meal"){
    $("subtitle").textContent = (it.info || "") + "  Â·  (ê³µíœ´ì¼/ì¼ìš”ì¼ ë°°ë‹¬ ë¯¸ì œê³µ)";
  }else{
    $("subtitle").textContent = it.info || "â€”";
  }
  $("curRange").textContent = `${it.start} ~ ${it.end}`;
  $("curInfo").textContent = `êµ¬ê°„ íƒ€ì…: ${tagText(it.type)}`;

  // ë‹¤ìŒ êµ¬ê°„
  const next = schedule[found.index + 1] || null;
  $("nextTitle").textContent = next ? next.label : "ë§ˆì§€ë§‰ êµ¬ê°„";
  $("nextRange").textContent = next ? `${next.start} ~ ${next.end}` : "â€”";

  // ë‚¨ì€ ì‹œê°„ + ì§„í–‰ë¥ 
  const endMin = toMin(it.end);
  const remainSec = (endMin - minNow) * 60;
  $("remain").textContent = fmtRemain(remainSec);

  const startMin = toMin(it.start);
  const prog = (minNow - startMin) / (endMin - startMin);
  $("progress").style.width = `${Math.max(0, Math.min(1, prog))*100}%`;

  highlightRow(it.key);

  // êµ¬ê°„ ë³€ê²½ ì‹œ ì¢…ì†Œë¦¬
  if(lastKey !== it.key){
    // ì „í™˜ ì—°ì¶œ(ì§§ì€ í”Œë˜ì‹œ)
    document.body.classList.add("flash");
    setTimeout(()=>document.body.classList.remove("flash"), 260);

    // ì¢…ì†Œë¦¬
    playBell(it.type);

    // ì•ˆë‚´ ìŒì„± (êµ¬ê°„ ì‹œì‘ ì‹œ)
    const say = (it.type==="class") ? `ì§€ê¸ˆë¶€í„° ${it.label}ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ì§‘ì¤‘í•´ì£¼ì„¸ìš”.` :
                (it.type==="break") ? `${it.label}ì…ë‹ˆë‹¤. ì´ë™í•˜ê³  íœ´ì‹í•˜ì„¸ìš”.` :
                (it.type==="meal")  ? `${it.label} ì‹œê°„ì…ë‹ˆë‹¤. ì‹ì‚¬í•˜ê³  ì¬ì •ë¹„í•˜ì„¸ìš”.` :
                (it.type==="open")  ? `${it.label} ì…ë‹ˆë‹¤.` :
                (it.type==="night") ? `${it.label}ì…ë‹ˆë‹¤. ì¡°ìš©íˆ ììœ¨í•™ìŠµí•˜ì„¸ìš”.` :
                `${it.label} ì…ë‹ˆë‹¤.`;
    speak(say);

    lastKey = it.key;
  }
}

function highlightRow(key){
  const rows = Array.from(document.querySelectorAll(".row"));
  let activeEl = null;
  rows.forEach(r=>{
    const isActive = !!key && r.dataset.key === key;
    r.classList.toggle("active", isActive);

    // Update tag text to be very obvious on TV
    const tagEl = r.querySelector(".tag");
    if(tagEl){
      if(isActive){
        tagEl.textContent = "â— ì§„í–‰ì¤‘";
      }else{
        const item = schedule.find(it=>it.key===r.dataset.key);
        tagEl.textContent = tagText(item ? item.type : "");
      }
    }
    if(isActive) activeEl = r;
  });

  // Auto-scroll the list so the active row is centered (only when it changes)
  if(key && activeEl && key !== window.__lastActiveKey){
    window.__lastActiveKey = key;
    try{
      activeEl.scrollIntoView({block:"center", inline:"nearest", behavior:"smooth"});
    }catch(e){
      // older TVs may not support behavior option
      try{ activeEl.scrollIntoView(); }catch(_){}
    }
  }
}


function tick(){
  try{
    _tickCore();
    const st = document.getElementById("statusText");
    if(st && st.dataset.err==="1"){ st.dataset.err="0"; }
  }catch(e){
    console.error(e);
    const st = document.getElementById("statusText");
    const msg = (e && (e.message||String(e))) || "unknown error";
    const stack = (e && e.stack) ? String(e.stack).split("\n").slice(0,2).join(" | ") : "";
    if(st){
      st.textContent = "ìš´ì˜ì‹œê°„ ë¡œë”© ì˜¤ë¥˜: " + msg + (stack ? " ("+stack+")" : "");
      st.dataset.err="1";
    }
    const r = document.getElementById("remain");
    if(r) r.textContent="--:--";
    const title = document.getElementById("title");
    if(title) title.textContent="â€”";
  }
}


// ---------- buttons ----------
$("btnSound").addEventListener("click", async ()=>{
  ensureAudio();
  try{
    await audioCtx.resume();
    soundEnabled = !soundEnabled;
    // bell.mp3ê°€ ìˆìœ¼ë©´ ìë™ ì‚¬ìš©
    probeBellMp3('bell.mp3');
$('volText').textContent = `${$('vol').value}%`;
    $("soundState").textContent = soundEnabled ? "ON" : "OFF";
    $("btnSound").textContent = soundEnabled ? "ì†Œë¦¬ ë„ê¸°" : "ì†Œë¦¬ ì¼œê¸°";
    if(soundEnabled){ playBell("class"); speak("ì¢…ì†Œë¦¬ê°€ ì¼œì¡ŒìŠµë‹ˆë‹¤."); }
  }catch(e){
    alert("ì†Œë¦¬ë¥¼ ì¼¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •/ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
  }
});

$("btnTest").addEventListener("click", ()=>{
  ensureAudio();
  if(!soundEnabled){
    alert("ë¨¼ì € 'ì†Œë¦¬ ì¼œê¸°'ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
    return;
  }
  playBell("class");
  setTimeout(()=>playBell("break"), 600);
  setTimeout(()=>playBell("meal"),  1200);
});


$("btnVoice").addEventListener("click", ()=>{
  voiceEnabled = !voiceEnabled;
  $("voiceState").textContent = voiceEnabled ? "ON" : "OFF";
  $("btnVoice").textContent = voiceEnabled ? "ì•ˆë‚´ ìŒì„± ë„ê¸°" : "ì•ˆë‚´ ìŒì„± ì¼œê¸°";
  if(voiceEnabled){
    speak("ì•ˆë‚´ ìŒì„±ì´ ì¼œì¡ŒìŠµë‹ˆë‹¤.");
  }else{
    if("speechSynthesis" in window) window.speechSynthesis.cancel();
  }
});

$("btnDayMode").addEventListener("click", ()=>{
  // auto -> weekday -> holiday -> auto ìˆœí™˜
  dayMode = (dayMode==="auto") ? "weekday" : (dayMode==="weekday") ? "holiday" : "auto";
  const label = (dayMode==="auto") ? "ì£¼ë§/ê³µíœ´ì¼ ìë™"
              : (dayMode==="weekday") ? "í‰ì¼ ê³ ì •"
              : "ê³µíœ´ì¼/ì¼ìš”ì¼ ê³ ì •";
  $("btnDayMode").textContent = label;
  // ì¦‰ì‹œ ë°˜ì˜
  updateBanner(new Date());
});


$("btnFull").addEventListener("click", async ()=>{
  const el = document.documentElement;
  try{
    if(!document.fullscreenElement){
      await el.requestFullscreen();
    }else{
      await document.exitFullscreen();
    }
  }catch(e){
    // ë¬´ì‹œ
  }
});


// bell selector + volume
// voice volume
$("voiceVol").addEventListener("input", ()=>{
  const v = Number($("voiceVol").value);
  voiceVolume = Math.max(0, Math.min(10, v/100));
  $("voiceVolText").textContent = `${v}%`;
});


$("bellSelect").addEventListener("change", ()=>{
  bellProfile = $("bellSelect").value;
  // MP3 ì„ íƒ ì‹œ ì¦‰ì‹œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸(ì—†ìœ¼ë©´ ìë™ fallback)
  if(bellProfile.startsWith("mp3_")){
    const fname = (bellProfile === "mp3_bell1") ? "bell1.mp3"
                : (bellProfile === "mp3_bell2") ? "bell2.mp3"
                : "bell.mp3";
    probeBellMp3(fname);
  }
});

$("vol").addEventListener("input", ()=>{
  const v = Number($("vol").value);
  bellVolume = Math.max(0, Math.min(10, v/100));
  $("volText").textContent = `${v}%`;
  if(bellMp3) bellMp3.volume = Math.max(0, Math.min(1, bellVolume));
});


// init
renderRows();
probeBellMp3('bell.mp3');
$('volText').textContent = `${$('vol').value}%`;
tick();
setInterval(tick, 1000);
</script>
<div id="toast"></div>
<script>

/* ===============================
   v4.6 ìš´ì˜ê¸°ëŠ¥ íŒ¨ì¹˜ (v4 ìŠ¤í¬ë¦½íŠ¸ ë³´ì¡´)
   =============================== */
(function(){
  const ADMIN_PASSWORD = "sam1101!";
  let adminLocked = true;

  let warnBreakEnd = true;
  let warnMealEnd  = true;
  let warnClassEnd = true;

  const toastEl = document.getElementById("toast");
  let toastTimer = null;
  function toast(msg){
    if(!toastEl) return;
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toastEl.classList.remove("show"), 1300);
  }

  function setLockUI(){
    const root = document.documentElement;
    if(root) root.classList.toggle('admin-on', !adminLocked);

    const btn = document.getElementById("adminLockBtn");
    if(btn){
      btn.classList.toggle("on", adminLocked);
      btn.textContent = adminLocked ? "ğŸ”’ ê´€ë¦¬ì ì ê¸ˆ(ON)" : "ğŸ”“ ê´€ë¦¬ì ì ê¸ˆ(OFF)";
    }
  }

  function intercept(e){
    if(!adminLocked) return;
    const t = e.target;
    if(!t) return;
    const id = t.id || "";
    if(id === "adminLockBtn" || id === "btnFull" || id==="themeBtn" || id==="themeAuto" || id==="themeLock") return;

    const top = document.querySelector(".topRight");
    if(top && top.contains(t) && (t.closest("button,input,select") || ["BUTTON","INPUT","SELECT"].includes(t.tagName))){
      e.preventDefault();
      e.stopPropagation();
      toast("ê´€ë¦¬ì ì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤. ì ê¸ˆ í•´ì œ í›„ ì¡°ì‘í•˜ì„¸ìš”.");
    }
  }

  function bindLock(){
    const btn = document.getElementById("adminLockBtn");
    if(btn){
      btn.addEventListener("click", ()=>{
        if(adminLocked){
          const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
          if(pw === null) return;
          if(pw !== ADMIN_PASSWORD){
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return;
          }
          adminLocked = false;
          toast("ì ê¸ˆ í•´ì œë¨");
        }else{
          adminLocked = true;
          toast("ì ê¸ˆ ì„¤ì •ë¨");
        }
        setLockUI();
      });
    }
    document.addEventListener("click", intercept, true);
    document.addEventListener("change", intercept, true);
    setLockUI();
  }

  function speakKo(text){
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ko-KR";
      u.volume = 1.0;
      window.speechSynthesis.cancel();
      window.speechSynthesis.resume();
      window.speechSynthesis.speak(u);
    }catch(e){
      console.warn(e);
      alert("ì•ˆë‚´ ìŒì„±ì´ ì¬ìƒë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Windows + Chrome ìµœì‹  ë²„ì „ì„ ê¶Œì¥í•©ë‹ˆë‹¤.");
    }
  }

  function bindVoiceTest(){
    const vtb = document.getElementById("voiceTestBtn");
    if(vtb){
      vtb.addEventListener("click", ()=>{
        if(adminLocked){
          toast("ì ê¸ˆ í•´ì œ í›„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì–´ìš”.");
          return;
        }
        speakKo("ì•ˆë‚´ ìŒì„± í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. í˜„ì¬ ìŒì„± ë³¼ë¥¨ê³¼ ë°œìŒì„ í™•ì¸í•´ ì£¼ì„¸ìš”.");
      });
    }
  }

  function bindVoiceVol(){
    const el = document.getElementById("voiceVol");
    const tx = document.getElementById("voiceVolText");
    if(!el) return;
    const sync=()=>{ if(tx) tx.textContent = `${el.value}%`; };
    sync();
    el.addEventListener("input", sync);
  }

  function bindWarnToggles(){
    const wbe = document.getElementById("warnBreakEnd");
    const wme = document.getElementById("warnMealEnd");
    const wce = document.getElementById("warnClassEnd");
    if(wbe) wbe.addEventListener("change", ()=> warnBreakEnd = wbe.checked);
    if(wme) wme.addEventListener("change", ()=> warnMealEnd  = wme.checked);
    if(wce) wce.addEventListener("change", ()=> warnClassEnd = wce.checked);
  }

  function toSec(hhmm){
    const [h,m]=hhmm.split(":").map(n=>parseInt(n,10));
    return h*3600+m*60;
  }
  function nowSec(){
    const d=new Date();
    return d.getHours()*3600 + d.getMinutes()*60 + d.getSeconds();
  }
  function todayKey(){
    const d=new Date();
    return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
  }
  let lastWarnKey = "";
  function checkWarn(){
    try{
      if(typeof schedule === "undefined" || !Array.isArray(schedule)) return;
      const n = nowSec();
      for(const seg of schedule){
        if(!seg || !seg.key || !seg.start || !seg.end) continue;
        const end = toSec(seg.end);
        const trig = end - 60;
        if(n === trig){
          const typ = (seg.type||"").toLowerCase();
          const ok =
            (typ==="break" && warnBreakEnd) ||
            (typ==="meal"  && warnMealEnd)  ||
            (typ==="class" && warnClassEnd);
          const k = `${todayKey()}|${seg.key}`;
          if(ok && lastWarnKey !== k){
            lastWarnKey = k;

            // ê¸°ì¡´ ì¢…ì†Œë¦¬ í…ŒìŠ¤íŠ¸ì™€ ê°™ì€ ë£¨íŠ¸ë¡œ ì‹¤í–‰ë˜ë„ë¡ 'btnTest' í´ë¦­ì„ íŠ¸ë¦¬ê±°
            try{
              const testBtn = document.getElementById("btnTest");
              if(testBtn){
                testBtn.click();
              }else if(typeof playBell === "function"){
                playBell(typ);
              }
            }catch(e){}

            let msg = "";
            if(typ==="break") msg = "íœ´ì‹ ì¢…ë£Œ 1ë¶„ ì „ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ìŒ êµì‹œê°€ ì‹œì‘ë©ë‹ˆë‹¤.";
            else if(typ==="meal") msg = "ì‹ì‚¬ ì‹œê°„ ì¢…ë£Œ 1ë¶„ ì „ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ìŒ êµì‹œê°€ ì‹œì‘ë©ë‹ˆë‹¤.";
            else msg = "ìˆ˜ì—… ì¢…ë£Œ 1ë¶„ ì „ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ìŒ êµì‹œë¡œ ì „í™˜ë©ë‹ˆë‹¤.";
            speakKo(msg);
          }
        }
      }
    }catch(e){}
  }

  function start(){
    bindLock();
    bindVoiceTest();
    bindVoiceVol();
    bindWarnToggles();
    setInterval(checkWarn, 1000);
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", start);
  }else{
    start();
  }
})();

</script>

<script>
/* ===== í…Œë§ˆ ì»¨íŠ¸ë¡¤ (ì‚¬ìš©ì ì„ íƒ/ìë™/ì ê¸ˆ) ===== */
(function(){
  const root = document.documentElement;
  const btn  = document.getElementById("themeBtn");
  const auto = document.getElementById("themeAuto");
  const lock = document.getElementById("themeLock");

  const THEMES = ["dark","light","contrast"];
  const labels = {dark:"ë‹¤í¬", light:"ë¼ì´íŠ¸", contrast:"ê³ ëŒ€ë¹„"};

  function applyTheme(theme){
    root.classList.remove("theme-light","theme-contrast");
    if(theme==="light") root.classList.add("theme-light");
    if(theme==="contrast") root.classList.add("theme-contrast");
    if(btn) btn.textContent = `ğŸŒ— í…Œë§ˆ: ${labels[theme]||"ë‹¤í¬"}`;
  }

  function getStored(){
    return {
      theme: localStorage.getItem("sparta_theme") || "dark",
      auto:  (localStorage.getItem("sparta_theme_auto") || "0") === "1",
      lock:  (localStorage.getItem("sparta_theme_lock") || "0") === "1"
    };
  }
  function store({theme, autoOn, lockOn}){
    if(theme) localStorage.setItem("sparta_theme", theme);
    localStorage.setItem("sparta_theme_auto", autoOn ? "1":"0");
    localStorage.setItem("sparta_theme_lock", lockOn ? "1":"0");
  }

  function pickAutoThemeByTime(){
    const d = new Date();
    const h = d.getHours();
    // ê¸°ë³¸: 07~18 ë¼ì´íŠ¸, ê·¸ ì™¸ ë‹¤í¬ (ì›í•˜ë©´ ì‰½ê²Œ ë³€ê²½ ê°€ëŠ¥)
    return (h >= 7 && h < 18) ? "light" : "dark";
  }

  function refresh(){
    const s = getStored();
    if(auto) auto.checked = s.auto;
    if(lock) lock.checked = s.lock;

    const theme = s.auto ? pickAutoThemeByTime() : s.theme;
    applyTheme(theme);
  }

  // í…Œë§ˆ ë³€ê²½(ìˆœí™˜)
  function cycleTheme(){
    const s = getStored();
    const current = s.theme;
    const idx = Math.max(0, THEMES.indexOf(current));
    const next = THEMES[(idx + 1) % THEMES.length];
    store({theme: next, autoOn: false, lockOn: s.lock});
    if(auto) auto.checked = false;
    applyTheme(next);
  }

  // ì ê¸ˆ ì •ì±…:
  // - themeLock ì²´í¬ ONì´ë©´: ê´€ë¦¬ì ì ê¸ˆ(ê¸°ë³¸ ê¸°ëŠ¥) í•´ì œ ìƒíƒœì—ì„œë§Œ ë³€ê²½ í—ˆìš©
  // - themeLock OFFë©´: ëˆ„êµ¬ë‚˜ ë³€ê²½ ê°€ëŠ¥(ì „ê´‘íŒ ì„¤ì¹˜ í™˜ê²½ì— ë”°ë¼ ì„ íƒ)
  function isAdminUnlocked(){
    // v4.6 íŒ¨ì¹˜ ë³€ìˆ˜ëŠ” í´ë¡œì €ë¼ ì ‘ê·¼ ë¶ˆê°€. ëŒ€ì‹  UI í† ìŠ¤íŠ¸ ë°©ì‹ì—ì„œ "ê´€ë¦¬ì ì ê¸ˆ(OFF)" í…ìŠ¤íŠ¸ë¡œ íŒë³„
    const adminBtn = document.getElementById("adminLockBtn");
    return adminBtn && adminBtn.textContent.includes("(OFF)");
  }

  if(btn){
    btn.addEventListener("click", ()=>{
      const s = getStored();
      if(s.lock && !isAdminUnlocked()){
        // ì ê¸ˆ ì¼œì§„ ìƒíƒœì—ì„œëŠ” ê´€ë¦¬ì ì ê¸ˆ í•´ì œ í•„ìš”
        try{
          const t = document.getElementById("toast");
          if(t){ t.textContent="í…Œë§ˆ ì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤. ê´€ë¦¬ì ì ê¸ˆ í•´ì œ í›„ ë³€ê²½í•˜ì„¸ìš”."; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1300); }
          else alert("í…Œë§ˆ ì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤. ê´€ë¦¬ì ì ê¸ˆ í•´ì œ í›„ ë³€ê²½í•˜ì„¸ìš”.");
        }catch(e){}
        return;
      }
      cycleTheme();
    });
  }

  if(auto){
    auto.addEventListener("change", ()=>{
      const s = getStored();
      store({theme: s.theme, autoOn: auto.checked, lockOn: s.lock});
      refresh();
    });
  }

  if(lock){
    lock.addEventListener("change", ()=>{
      const s = getStored();
      store({theme: s.theme, autoOn: s.auto, lockOn: lock.checked});
    });
  }

  // ìë™ ëª¨ë“œë©´ ë§¤ ë¶„ë§ˆë‹¤ í…Œë§ˆ ì¬í‰ê°€(ì‹œê°„ëŒ€ ë„˜ì–´ê°ˆ ë•Œ ìë™ ì „í™˜)
  setInterval(()=>{
    const s = getStored();
    if(s.auto) refresh();
  }, 60*1000);

  refresh();
})();
</script>


<div id="fsPrompt">
  <div class="box">
    <div class="title">ì „ì²´í™”ë©´ìœ¼ë¡œ ì „í™˜í• ê¹Œìš”?</div>
    <div class="desc">ì „ê´‘íŒ/TVì—ì„œëŠ” ì „ì²´í™”ë©´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.<br/>ì•„ë¬´ ê³³ì´ë‚˜ í•œ ë²ˆ í„°ì¹˜í•´ë„ ì „ì²´í™”ë©´ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.</div>
    <div class="actions">
      <button id="fsGoBtn">ì „ì²´í™”ë©´</button>
      <button id="fsLaterBtn" class="secondary">ë‚˜ì¤‘ì—</button>
    </div>
  </div>
</div>


<script>
/* ===== v4.7.4: (1) ìƒˆë¡œê³ ì¹¨ ë°©ì§€ (2) ì „ì›ON í›„ ìë™ ì „ì²´í™”ë©´ ìœ ë„ ===== */
(function(){
  const toast = (msg)=>{
    const t=document.getElementById("toast");
    if(t){ t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1300); }
    else alert(msg);
  };

  // (1) ìƒˆë¡œê³ ì¹¨/ê°•ë ¥ìƒˆë¡œê³ ì¹¨/ë‹«ê¸° ë°©ì§€(í‚¤ ì…ë ¥ ì°¨ë‹¨)
  const blockKeys = (e)=>{
    const k = e.key;
    const ctrl = e.ctrlKey || e.metaKey;
    const shift = e.shiftKey;

    const isRefresh =
      k === "F5" ||
      (ctrl && (k.toLowerCase() === "r" || k.toLowerCase() === "w")) || // Ctrl+R, Ctrl+W
      (ctrl && shift && k.toLowerCase() === "r"); // Ctrl+Shift+R

    if(isRefresh){
      e.preventDefault();
      e.stopPropagation();
      toast("ìƒˆë¡œê³ ì¹¨/ì¢…ë£Œê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. (ê´€ë¦¬ìë§Œ ì¡°ì‘)");
      return false;
    }
  };
  window.addEventListener("keydown", blockKeys, {capture:true});

  // íƒ­/ì°½ ë‹«ê¸° ê²½ê³ (ì™„ì „ ì°¨ë‹¨ì€ ë¶ˆê°€, ë¸Œë¼ìš°ì € ì •ì±…)
  window.addEventListener("beforeunload", (e)=>{
    // ê´€ë¦¬ì ëª¨ë“œ(ì ê¸ˆí•´ì œ)ë©´ ë§‰ì§€ ì•ŠìŒ
    const root=document.documentElement;
    const adminOn = root.classList.contains("admin-on");
    if(adminOn) return;
    e.preventDefault();
    e.returnValue = "";
  });

  // (2) ìë™ ì „ì²´í™”ë©´ ìœ ë„: ì „ì› ì¼œì ¸ì„œ ë‹¤ì‹œ ì—´ë¦´ ë•Œ "ì²« í„°ì¹˜"ë¡œ ì „ì²´í™”ë©´ ì§„ì…
  const fsPrompt = document.getElementById("fsPrompt");
  const fsGoBtn  = document.getElementById("fsGoBtn");
  const fsLaterBtn = document.getElementById("fsLaterBtn");

  function requestFs(){
    const el = document.documentElement;
    const req = el.requestFullscreen || el.webkitRequestFullscreen || el.mozRequestFullScreen || el.msRequestFullscreen;
    if(req) req.call(el).catch(()=>{});
  }
  function isFs(){
    return !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
  }
  function showPrompt(){
    if(!fsPrompt) return;
    fsPrompt.style.display = "flex";
  }
  function hidePrompt(){
    if(!fsPrompt) return;
    fsPrompt.style.display = "none";
  }

  // ì²« í„°ì¹˜ë¡œ ì „ì²´í™”ë©´: "ì‚¬ìš©ì ì œìŠ¤ì²˜" ìš”êµ¬ë¥¼ ì¶©ì¡±í•˜ê¸° ìœ„í•´ one-time listener ì‚¬ìš©
  function armOneTapFullscreen(){
    const handler = ()=>{
      hidePrompt();
      if(!isFs()) requestFs();
      window.removeEventListener("pointerdown", handler, true);
      window.removeEventListener("touchstart", handler, true);
      window.removeEventListener("mousedown", handler, true);
    };
    window.addEventListener("pointerdown", handler, true);
    window.addEventListener("touchstart", handler, true);
    window.addEventListener("mousedown", handler, true);
  }

  // í˜ì´ì§€ ë¡œë“œì‹œ ì „ì²´í™”ë©´ì´ ì•„ë‹ˆë©´ ì•ˆë‚´ë¥¼ ë„ìš°ê³ , ì²« í„°ì¹˜ë¡œ ì§„ì…
  window.addEventListener("load", ()=>{
    // ëª¨ë°”ì¼ì—ì„œ ì£¼ì†Œì°½ ìë™ ìˆ¨ê¹€ ìœ ë„
    setTimeout(()=>window.scrollTo(0,1), 50);

    if(!isFs()){
      showPrompt();
      armOneTapFullscreen();
    }
  });

  if(fsGoBtn){
    fsGoBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      hidePrompt();
      requestFs();
    });
  }
  if(fsLaterBtn){
    fsLaterBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      hidePrompt();
      toast("ì „ì²´í™”ë©´ì€ ìš°ì¸¡ 'ì „ì²´í™”ë©´' ë²„íŠ¼ìœ¼ë¡œ ì–¸ì œë“  ì¼¤ ìˆ˜ ìˆì–´ìš”.");
    });
  }
})();
</script>


<script>
/* ===== v4.7.5 í˜„ì¬ì‹œê°„ ê°•ì¡° KST ë³´ì • íŒ¨ì¹˜ ===== */
(function(){
  function getNowMinutesKST(){
    const now = getKSTDate();
    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
    const kst = new Date(utc + (9 * 60 * 60000));
    return kst.getHours() * 60 + kst.getMinutes();
  }
  function toMinutes(t){
    if(!t) return -1;
    const p = t.split(":").map(Number);
    return p[0]*60 + p[1];
  }

  function highlightCurrentSlotKST(){
    const nowMin = getNowMinutesKST();
    document.querySelectorAll("[data-start][data-end]").forEach(row=>{
      const s = toMinutes(row.dataset.start);
      const e = toMinutes(row.dataset.end);
      if(s <= nowMin && nowMin < e){
        row.classList.add("active");
      }else{
        row.classList.remove("active");
      }
    });
  }

  window.addEventListener("load", ()=>{
    highlightCurrentSlotKST();
    setInterval(highlightCurrentSlotKST, 30000);
  });
})();
</script>


<script>
/* ===== v4.7.6: í˜„ì¬ì‹œê°(KST) í‘œì‹œ + 3ë‹¨ê³„(5ë¶„/1ë¶„/ì¢…ë£Œ) ì•ˆë‚´ ===== */
(function(){
  function getKSTDate(){
    const now = getKSTDate();
    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
    return new Date(utc + (9 * 60 * 60000));
  }
  function pad2(n){ return String(n).padStart(2,"0"); }
  function formatHMS(d){ return `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`; }
  function toMinutes(t){
    if(!t) return -1;
    const p = t.split(":").map(Number);
    return p[0]*60 + p[1];
  }
  function nowSecondsKST(){
    const d = getKSTDate();
    return d.getHours()*3600 + d.getMinutes()*60 + d.getSeconds();
  }
  function tickClock(){
    const el = document.getElementById("nowClock");
    if(el) el.textContent = formatHMS(getKSTDate());
  }

  function speakKo(text){
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ko-KR";
      u.volume = 1.0;
      window.speechSynthesis.cancel();
      window.speechSynthesis.resume();
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  function ringBell(type){
    try{
      const testBtn = document.getElementById("btnTest");
      if(testBtn){ testBtn.click(); return; }
    }catch(e){}
    try{
      if(typeof playBell === "function") return playBell(type);
      if(typeof playBellSound === "function") return playBellSound(type);
    }catch(e){}
  }

  const getTypeEnabled = (type)=>{
    if(type==="break"){ const el=document.getElementById("warnBreakEnd"); return el ? el.checked : true; }
    if(type==="meal"){  const el=document.getElementById("warnMealEnd");  return el ? el.checked : true; }
    if(type==="class"){ const el=document.getElementById("warnClassEnd"); return el ? el.checked : true; }
    return true;
  };
  const getStageEnabled = (stage)=>{
    if(stage===5){ const el=document.getElementById("stage5"); return el ? el.checked : true; }
    if(stage===1){ const el=document.getElementById("stage1"); return el ? el.checked : true; }
    if(stage===0){ const el=document.getElementById("stage0"); return el ? el.checked : true; }
    return true;
  };

  function msgFor(type, stage){
    const next = "ë‹¤ìŒ êµì‹œ";
    if(type==="break"){
      if(stage===5) return `íœ´ì‹ ì¢…ë£Œ 5ë¶„ ì „ì…ë‹ˆë‹¤. ${next} ì¤€ë¹„í•´ ì£¼ì„¸ìš”.`;
      if(stage===1) return `íœ´ì‹ ì¢…ë£Œ 1ë¶„ ì „ì…ë‹ˆë‹¤. ${next}ê°€ ê³§ ì‹œì‘ë©ë‹ˆë‹¤.`;
      return `íœ´ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${next}ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.`;
    }
    if(type==="meal"){
      if(stage===5) return `ì‹ì‚¬ ì‹œê°„ ì¢…ë£Œ 5ë¶„ ì „ì…ë‹ˆë‹¤. ${next} ì¤€ë¹„í•´ ì£¼ì„¸ìš”.`;
      if(stage===1) return `ì‹ì‚¬ ì‹œê°„ ì¢…ë£Œ 1ë¶„ ì „ì…ë‹ˆë‹¤. ${next}ê°€ ê³§ ì‹œì‘ë©ë‹ˆë‹¤.`;
      return `ì‹ì‚¬ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${next}ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.`;
    }
    if(stage===5) return `ìˆ˜ì—… ì¢…ë£Œ 5ë¶„ ì „ì…ë‹ˆë‹¤. ë§ˆë¬´ë¦¬í•´ ì£¼ì„¸ìš”.`;
    if(stage===1) return `ìˆ˜ì—… ì¢…ë£Œ 1ë¶„ ì „ì…ë‹ˆë‹¤. ì ì‹œ í›„ ${next}ë¡œ ì „í™˜ë©ë‹ˆë‹¤.`;
    return `ìˆ˜ì—…ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ${next}ë¡œ ì „í™˜í•©ë‹ˆë‹¤.`;
  }

  function todayKey(){
    const d=getKSTDate();
    return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
  }
  const fired = new Set();

  function check3Stage(){
    try{
      if(typeof schedule === "undefined" || !Array.isArray(schedule)) return;
      const nSec = nowSecondsKST();

      for(const seg of schedule){
        if(!seg || !seg.key || !seg.start || !seg.end) continue;
        const type = (seg.type||"").toLowerCase();
        if(!getTypeEnabled(type)) continue;

        const endMin = toMinutes(seg.end);
        if(endMin < 0) continue;
        const endSec = endMin * 60;

        for(const st of [5,1,0]){
          if(!getStageEnabled(st)) continue;
          const trigSec = endSec - (st*60);
          if(nSec === trigSec){
            const k = `${todayKey()}|${seg.key}|${st}`;
            if(fired.has(k)) continue;
            fired.add(k);
            ringBell(type);
            speakKo(msgFor(type, st));
          }
        }
      }
    }catch(e){}
  }

  window.addEventListener("load", ()=>{
    tickClock();
    setInterval(tickClock, 1000);
    setInterval(check3Stage, 1000);
  });
})();
</script>


<div id="adminPwModal" aria-hidden="true">
  <div class="adminPwBackdrop"></div>
  <div class="adminPwCard" role="dialog" aria-modal="true" aria-labelledby="adminPwTitle">
    <div class="adminPwTitle" id="adminPwTitle">ê´€ë¦¬ì ì ê¸ˆ í•´ì œ</div>
    <div class="adminPwDesc">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>
    <input id="adminPwInput" type="password" inputmode="text" autocomplete="off" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <div class="adminPwActions">
      <button id="adminPwCancel" class="btnSecondary">ì·¨ì†Œ</button>
      <button id="adminPwOk" class="btnPrimary">í™•ì¸</button>
    </div>
  </div>
</div>


<script>
/* ===== v4.7.7: ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ë¡œì§ ===== */
(function(){
  const modal = document.getElementById("adminPwModal");
  if(!modal) return;

  const input = document.getElementById("adminPwInput");
  const okBtn = document.getElementById("adminPwOk");
  const cancelBtn = document.getElementById("adminPwCancel");
  const backdrop = modal.querySelector(".adminPwBackdrop");

  let resolver = null;

  window.openAdminPwModal = function(){
    modal.classList.add("show");
    modal.setAttribute("aria-hidden","false");
    if(input){ input.value=""; setTimeout(()=>input.focus(), 30); }
    return new Promise((resolve)=>{ resolver = resolve; });
  };

  function close(val){
    modal.classList.remove("show");
    modal.setAttribute("aria-hidden","true");
    if(resolver){ const r=resolver; resolver=null; r(val); }
  }

  okBtn && okBtn.addEventListener("click", ()=> close(input ? input.value : ""));
  cancelBtn && cancelBtn.addEventListener("click", ()=> close(null));
  backdrop && backdrop.addEventListener("click", ()=> close(null));

  window.addEventListener("keydown", (e)=>{
    if(!modal.classList.contains("show")) return;
    if(e.key === "Escape"){ e.preventDefault(); close(null); }
    if(e.key === "Enter"){ e.preventDefault(); close(input ? input.value : ""); }
  });
})();
</script>

</body>
</html>
